{% assign collection = site.[include.collection] | sort: "label" %}

<div id="brueghel-gallery-{{ include.collection }}-container" class="brueghel-gallery-container container-fluid flex-column flex-md-row">
	<div id="{{ include.collection }}-facet-buttons" class="facet-buttons col-12 col-md-2 flex-row flex-md-column"></div>
  <div id="brueghel-gallery-{{ include.collection }}" class="brueghel-gallery col-12 col-md-10 ml-md-5"></div>
</div>

<script type="text/javascript">
  $( document ).ready(function() {
    var container = $('#brueghel-gallery-{{ include.collection }}-container');
    var gallery = $('#brueghel-gallery-{{ include.collection }}');
    var buttonDiv = $('#{{ include.collection }}-facet-buttons');

    {% for item in collection %}
      {% if include.facet_by == 'worktags' %}
        {% assign facetvalue = item[include.facet_by] | slugify: "raw" | replace: "/", "-" | replace: "|", " " %}
      {% else %}
        {% assign facetvalue = item[include.facet_by] | slugify %}
      {% endif %}

      {%- capture item_html -%}
        '{% include gallery_item.html value=facetvalue item=item %}'
      {%- endcapture -%}
      gallery.append({{ item_html | strip_newlines }});
    {% endfor %}

    {% if include.facet_by %}
      {% if include.facet_by == 'worktags' %}
        {% assign rawTagArray = [] %}
          {%- for item in collection -%}
            {% assign worktags = item[include.facet_by] | split: '|' %}
            {% assign rawTagArray = rawTagArray | concat: worktags %}
          {% endfor %}
        var facets = Array.from(new Set([{%- for worktag in rawTagArray -%}'{{ worktag }}'{% unless forloop.last %}, {% endunless %}{%- endfor -%}])).sort();
      {% else %}
        var facets = Array.from(new Set([{%- for item in collection -%}'{{ item[include.facet_by] }}'{% unless forloop.last %}, {% endunless %}{%- endfor -%}])).sort();
      {% endif %}
      buttonDiv.append("<button class='btn facet active' data-filter='all'>show all</button>");
      
      for (i in facets) {
          var slug = facets[i].replace(/\s/g, "-").replace(/,/g, "").replace(/\//g, "-");
          buttonDiv.append(`<button class='btn facet' data-filter='${slug.toLowerCase()}'>${facets[i]}</button>`);
        }

        $(document).ready(function(){
          $(".facet").click(function(){
            var filterValue = $(this).attr('data-filter');
            $('.facet').removeClass('active');
            $(this).addClass('active');
            if(filterValue == 'all') { $('.all').show(); }
            else { $('.all').hide(); $(`.${filterValue}`).show(); }
          });
        });
    {% endif %}
  });
</script>
